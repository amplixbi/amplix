function m$B2(t,a){var e=this;e.ind=t,e.rowdata=a,e.ellipses=[],e.label=$("<div class='bblabel'></div>"),e.html=$("<div class='bbbox'></div>"),e.ind.container.append(e.html),e.paper=new Raphael(e.html[0]),e.html.append(e.label),e.invalidate=-1,e.validateData.call(e)}function m$Bl(t){this.parent=t,this.mv=null,this.colorset=[.23,.4,.3],this.initVariables()}m$B2.prototype={validateData:function(){for(var t,a=this,e=a.ellipses,l=a.ind.colorset,i=a.rowdata,n=0;n<e.length;n++)e[n].html.remove();for(e=[],a.label.text(i.name),n=0;n<i.value.length;n++)(t={}).color=l[n%l.length],e.push(t);a.ellipses=e,a.validateDisplay()},validateDisplay:function(){var t=this;-1<t.invalidate&&clearTimeout(t.invalidate),setTimeout(function(){t.updateDisplay.call(t)},100)},updateDisplay:function(){var t,a,e,l,i,n,h,s,o,r,m,c,p=this,u=p.ind,v=p.html,b=IG$.j$ext._w(v),d=IG$.j$ext._h(v),f=p.rowdata,x=p.ellipses,$=u.mcalc.max,g=null!=u.mv&&u.mv>u.mcalc.min?u.mv:u.mcalc.min,y=p.label;if(0<b&&0<d){if((o=p.paper).clear(),o.setSize(b,d),x&&0<x.length){for(l=Math.min(b,d),a=$==g?$:$-g,s=0;s<x.length;s++)h=0==s?f.value[s]:h+f.value[s];for(n=(h-g)/a*(.8*l)+.1*l,s=0;s<x.length;s++)i=0==s?f.value[s]:i+f.value[s],e=Math.sqrt(n*n*i/h),(t=x[s]).x=b/2,t.y=d/2,t.radius=e/2;for(s=x.length-1;0<=s;s--)r=(t=x[s]).x,m=t.y,c=t.radius,hue=t.color,t.circle=o.set(o.ellipse(r,m+c-c/5,0,0).attr({fill:"rhsb("+hue+", 1, .25)-hsb("+hue+", 1, .25)",stroke:"none",opacity:0}).animate({rx:c,ry:c/2},400,"<"),o.ellipse(r,m,0,0).attr({fill:"r(.5,.9)hsb("+hue+", 1, .75)-hsb("+hue+", .5, .25)",stroke:"none"}).animate({rx:c,ry:c},400,"<"),o.ellipse(r,m,0,0).attr({stroke:"none",fill:"r(.5,.1)#ccc-#ccc",opacity:0}).animate({rx:c-c/5,ry:c-c/20},400,"<"))}p.label.css({top:d-y.height()-4,left:(b-IG$.j$ext._w(p.label))/2})}}},m$Bl.prototype={initVariables:function(){var t=this;t.ex=[],t.mx=[],t.bubbles=[],t.mcalc={},t.container=$("<div class='bbmain'></div>").appendTo(t.parent)},initControl:function(){for(var t=this.bubbles,a=0;a<t.length;a++)t[a].html.remove();t=[]},loadData:function(t){var a,e,l,i,n,h,s,o,r=this,m=r.ea,c=r.ma,p=r.mcalc;if(t&&0<t.length&&m&&0<m.length&&c&&0<c.length){for(a=0;a<c.length;a++)c[a].max=0,c[a].min=0;for(a=0;a<t.length;a++){for(i="",h=[],e=0;e<m.length;e++)l=m[e].i,i=0==e?t[a][l]:i+" "+t[a][l];for(e=0;e<c.length;e++)l=c[e].i,n=Number(t[a][l]),0==a?(c[e].min=n,c[e].max=n):(c[e].min=Math.min(c[e].min,n),c[e].max=Math.max(c[e].max,n)),s=0==e?n:s+n,h.push(n);0==a?(p.min=s,p.max=s):(p.min=Math.min(p.min,s),p.max=Math.max(p.max,s)),o=new m$B2(r,{name:i,value:h}),r.bubbles.push(o)}r.validateControl()}},validateControl:function(){var t,a,e,l,i,n=$(this.parent),h=IG$.j$ext._w(n),s=IG$.j$ext._h(n),o=this.bubbles;if(0<h&&0<s&&o&&0<o.length)for(i=0,e=h/o.length,l=s,a=0;a<o.length;a++)(t=o[a]).html.css({left:i,top:0,position:"absolute"}),IG$.j$ext._w(t.html,e),IG$.j$ext._h(t.html,l),t.validateDisplay.call(t),i+=e}};
IG$.m$CompMatrix=function(){this.xField=null,this.xFieldName=null,this.yField=null,this.yFieldName=null,this.compVal,this.dataSet=null,this.toString=function(){return this.xFieldName+", "+this.yFieldName+" : "+this.compVal}},IG$.compMatrixPlotCell=function(){var n,t,i=window.bowser,e=window&&window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");this.hasCanvas=!e&&!i.msie,this.compItem,this.xMin,this.xMax,this.yMin,this.yMax,this.xRange,this.yRange,this.cr1=0,this.cr2=0,this.selected,this.width,this.height,this.html=$('<div class="matrixchart"></div>'),1==this.hasCanvas&&(this.canvas=$("<canvas></canvas>"),this.canvas.appendTo(this.html)),this.updateExtremes=function(){if(this.compItem&&this.compItem.dataSet){for(this.xMin=Number.MAX_VALUE,this.yMin=Number.MAX_VALUE,this.xMax=Number.MIN_VALUE,this.yMax=Number.MIN_VALUE,n=0;n<this.compItem.dataSet.length;n++)t=this.compItem.dataSet[n],this.xMin=Math.min(this.xMin,t[this.compItem.xField]),this.yMin=Math.min(this.yMin,t[this.compItem.yField]),this.xMax=Math.max(this.xMax,t[this.compItem.xField]),this.yMax=Math.max(this.yMax,t[this.compItem.yField]);this.xRange=this.xMax-this.xMin,this.yRange=this.yMax-this.yMin}},this.computeX=function(t){var i=t[this.compItem.xField];return 1-(this.xMax-i)/this.xRange},this.computeY=function(t){var i=t[this.compItem.yField];return 1-(this.yMax-i)/this.yRange},this.updatePlot=function(){var t,i,e,s;for(this.plotData=[],t=0;t<this.compItem.dataSet.length;t++)i=this.compItem.dataSet[t],e=this.computeX(i),s=this.computeY(i),this.plotData.push([e,s]);this.drawPlot()},this.drawPlot=function(){this.width=this.html.innerWidth(),this.height=this.html.innerHeight();var t={},i=this.compItem.compVal>this.cr2?"rgba(0,0,255,":this.compItem.compVal>this.cr1?"rgba(150,150,150,":"rgba(255,0,0,";for(1==this.hasCanvas?(this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas[0].getContext("2d"),this.ctx.scale(1,1),this.ctx.fillStyle="rgb(255,255,255)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.strokeStyle="#5F5F5F",this.ctx.lineWidth=1,this.ctx.fillStyle=i+".5)"):this.paper?this.paper.clear():this.paper=Raphael(this.html[0],0,0,this.width,this.height),n=0;n<this.plotData.length;n++){var e,s=this.plotData[n],h=0==isNaN(s[0])?s[0]*this.width:0,a=0==isNaN(s[1])?(1-s[1])*this.height:this.height,l=Math.floor(h),o=Math.floor(a);t[e=(l-=l%5)+","+(o-=o%5)]||(1==this.hasCanvas?(this.ctx.beginPath(),this.ctx.arc(h,a,1,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),t[e]={obj:!0,mbody:0}):(t[e]={obj:this.paper.circle(h,a,2),mbody:0},t[e].obj.attr("fill",i+"0.5)")))}t=null},this.updateDispList=function(t,i){this.drawPlot()},this.commitProps=function(){this.updateExtremes(),this.updatePlot()}},IG$.ComparisonMatrix=function(t,i){this.compItems=null,this.cells=[],this.parent=t,this.config=i,this.textFields=[],this.showLabels=i.showLabels||!0,this.cr1=null==i.cr1||void 0===i.cr1?0:i.cr1,this.cr2=null==i.cr2||void 0===i.cr2?0:i.cr2,this.container=$('<div class="matrixcontainer"></div>'),this.container.appendTo(this.parent),this.labelhtml=$('<div class="matrixlabel"></div>'),this.labelhtml.css({position:"absolute",top:"0px",left:"0px",width:"0px",height:"0px"}),this.labelhtml.appendTo(this.parent),this.isDirty=!1,this.detailviewer=$('<div class="detailviewer"></div>'),this.detailviewer.css({position:"absolute",top:10,left:10,width:100,height:100,margin:0,padding:0,backgroundColor:"#ececec",borderColor:"#222222",display:"none"}),this.detailviewer.appendTo(this.parent),this.detailviewer.bind("click",function(){$(this).fadeOut()}),this.detailcontainer=$('<div class="detailmatrixplot"></div>'),this.detailcontainer.css({position:"absolute",margin:"20 0 0 0",padding:0,top:0,left:0,right:0,bottom:0}),this.uid=0,this.detailcontainer.appendTo(this.detailviewer);var e=$('<div class="detailmatrixclosebtn"></div>'),s=this.detailviewer;e.css({position:"absolute",top:2,width:16,height:16,right:2}),this.detailviewer.append(e),e.bind({click:function(){s.fadeOut()}}),this.correlationCoefficient=function(t,i,e){for(var s,h=t.length,a=0,l=0,o=0,n=0,r=0,c=0;c<t.length;c++){var d=(s=t[c])[i],m=s[e];a+=d,l+=m,o+=Math.pow(d,2),n+=Math.pow(m,2),r+=d*m}return(h*r-a*l)/(Math.sqrt(h*o-Math.pow(a,2))*Math.sqrt(h*n-Math.pow(l,2)))},this.comparisonFunction=this.correlationCoefficient,this.generateComparisonStatistics=function(){if(this.compItems=[],0!=this.fields.length&&null!=this.dataSet&&0!=this.dataSet.length)for(var t=this.fields.length,i=0;i<t;i++)for(var e,s=0;s<i+1;s++){i!=s&&((e=new IG$.m$CompMatrix).xFieldName=this.fields[i],e.xField=i,e.yFieldName=this.fields[s],e.yField=s,e.compVal=this.comparisonFunction.call(this,this.dataSet,e.xField,e.yField),this.compItems.push(e),0)}},this.createOrRemoveCells=function(){var t,i=this,e=this.compItems.length;for(this.matrixitems={};this.cells.length<e;){var s=new IG$.compMatrixPlotCell;s.html.css({border:"1px solid #a5a5a5",width:200,height:200,position:"absolute",padding:0}),s.html.appendTo(this.container),t="matrixplot"+this.uid,s.html[0].id=t,this.uid++,s.html.bind({click:function(){i.drawDetailPlot.call(i,this)}}),this.cells.push(s),this.matrixitems[t]=s}for(;e<this.cells.length;){this.cells.pop().remove()}},this.updateTextFields=function(){for(var t,i=this.fields.length,e=0;e<i;e++)this.textFields.length<e+1&&((t=$('<div class="matrixtextfield"></div>')).css({fontSize:"0.8em",padding:"0 0 0 3",margin:0,position:"absolute",width:130}),this.textFields.push(t),t.appendTo(this.labelhtml)),this.textFields[e][0].innerText=this.fields[e];for(;i<this.textFields.length;){textFields.pop();this.textFieldToRemove.remove()}},this.layoutTextFields=function(){var t,i,e,s,h,a=this.textFields.length;if(0<a)for(t=this.textFields[0].height(),i=0;i<a;i++)e=this.textFields[i],s=i*this.actualCellSize+1,h=0==i?0:(i-1)*this.actualCellSize+t,e.css({left:s,top:h})},this.layoutCells=function(){var t,i=0;this.showLabels&&0<this.textFields.length&&(i=(t=this.textFields[0]).position().top+t.height());for(var e=this.fields.length,s=0,h=0;h<e;h++)for(var a,l,o,n,r,c=0;c<h+1;c++){h!=c&&(a=this.compItems[s],l=this.cells[s],a.dataSet=this.dataSet,l.compItem=a,l.selected=a==this.selectedItem,o=a.xField+"\n"+a.yField+"\n"+a.compVal,l.toolTip=o,n=c*this.actualCellSize,r=(h-1)*this.actualCellSize+i,l.html.css({left:n,top:r,width:this.actualCellSize,height:this.actualCellSize}),l.cr1=this.cr1,l.cr2=this.cr2,1==this.isDirty?l.commitProps.call(l):l.updateDispList.call(l),s++)}},this.computeCellSize=function(t,i){var e=t,s=i,s=1==this.showLabels&&0<this.textFields.length?(e=t-this.textFields[this.textFields.length-1].width(),i-this.textFields[0].height()):(e=t,i);return Math.min(e,s)/(this.fields.length-1)},this.updateDispList=function(){var t=$(this.parent),i=t.innerWidth(),e=t.innerHeight();this.container.css({width:i,height:e}),this.actualCellSize=this.computeCellSize(i,e),this.showLabels&&0<this.textFields.length&&this.layoutTextFields(),this.layoutCells()},this.commitProp=function(){this.isDirty=!0,this.generateComparisonStatistics(),this.createOrRemoveCells(),this.updateTextFields(),this.updateDispList(),this.isDirty=!1}},IG$.ComparisonMatrix.prototype.drawDetailPlot=function(t){var i,e,s,h,a,l=this.matrixitems[t.id],o=l.compItem.compVal>this.cr2?"rgba(0,0,255,.5)":l.compItem.compVal>this.cr1?"rgba(150,150,150,.5)":"rgba(255,0,0,0.5)";l&&(i={chart:{renderTo:this.detailcontainer[0],defaultSeriesType:"scatter",zoomType:"xy"},title:{text:l.compItem.xFieldName+" vs. "+l.compItem.yFieldName},xAxis:{title:{enabled:!0,text:l.compItem.xFieldName},startOnTick:!0,endOnTick:!0,showLastLabel:!0,min:0,max:1},yAxis:{title:{text:l.compItem.yFieldName},min:0,max:1},tooltip:{formatter:function(){return this.x+", "+this.y}},legend:{enabled:!1,layout:"vertical",align:"left",verticalAlign:"top",floating:!0,backgroundColor:"#FFFFFF",borderWidth:1},plotOptions:{scatter:{marker:{radius:5,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},states:{hover:{marker:{enabled:!1}}}}},series:[{name:"comparison",color:o,data:l.plotData}]},s=(e=$(this.parent)).width(),h=e.height(),a=.85*Math.min(h,s),this.detailviewer.css({left:s-a-10,top:5,width:a,height:a}),this.detailviewer.show(),this.plotdetail=new Highcharts.Chart(i))};
IG$.c$NatChart=function(t,a,n){this.owner=t,this.sheetoption=a,this.cop=n,this.initialize()},IG$.c$NatChart.prototype={initialize:function(){var t=this,a=t.owner;$("<div></div>").appendTo(a);t.margin={top:19.5,right:19.5,bottom:19.5,left:39.5},t.width=IG$.j$ext._w(a),t.height=IG$.j$ext._h(a)},loadData:function(t){var a,n,e,r,o,i,d,s=this,l=(s.owner,s.width,s.height,s.margin,$("<div><div>").appendTo(s.owner),s.bb,t._tabledata),c=t.colfix,f=t.rowfix,m=0<l.length?l[0].length:0,u=[],h={},p=-1<(_=-1<(C=c-1)-1?C-1:C)-1?_-1:_,b=c,g=c+1<m?c+1:b,x=b+1<m?b+1:b,v={},w=0,M=[],y=[{m:0,M:0},{m:0,M:0},{m:0,M:0}],N=s.findCols(s.cop.nat_timefield,c),p=-1<N?N:p,C=-1<(N=s.findCols(s.cop.nat_datafield,c))?N:C,_=-1<(N=s.findCols(s.cop.nat_groupfield,c))?N:_,b=-1<(N=s.findCols(s.cop.nat_xdata,c))?N:b,g=-1<(N=s.findCols(s.cop.nat_ydata,c))?N:g,x=-1<(N=s.findCols(s.cop.nat_vdata,c))?N:x;if(0<c){for(n=f;n<l.length;n++)v[i=l[n][p].code||""]||(M.push(i),v[i]=1);for(w=M.length,M=M.sort(),v={},n=0;n<M.length;n++)v[M[n]]=n;for(n=f;n<l.length;n++){if(h[a=l[n][C].code])r=h[a];else{for(r={name:l[n][C].code,region:l[n][_].code,bbdata1:[],bbdata2:[],bbdata3:[]},e=0;e<M.length;e++)r.bbdata1.push([e,0]),r.bbdata2.push([e,0]),r.bbdata3.push([e,0]);h[a]=r,u.push(r)}o=-1,void 0!==v[i=l[n][p].code||""]&&(o=v[i]),d=Number(l[n][b].code)||0,d=isNaN(d)?0:d,r.bbdata1[o][1]=d,y[0].m=Math.min(d,y[0].m),y[0].M=Math.max(d,y[0].M),d=Number(l[n][g].code)||0,d=isNaN(d)?0:d,r.bbdata2[o][1]=d,y[1].m=Math.min(d,y[1].m),y[1].M=Math.max(d,y[1].M),d=Number(l[n][x].code)||0,d=isNaN(d)?0:d,r.bbdata3[o][1]=d,y[2].m=Math.min(d,y[2].m),y[2].M=Math.max(d,y[2].M)}}if(y)for(n=0;n<y.length;n++)y[n].m==y[n].M&&(y[n].M=y[n].m+10);s.segnames=v,s.seglists=M,s.segmax=w,s.fs=y,s.dt=u,s.drawChart()},drawChart:function(){var t,e=this,n=(e.owner,e.dt),a=e.fs;function r(t){return t.bbdata1}function o(t){return t.bbdata2}function i(t){return t.bbdata3}function d(t){return t.name}e.owner.empty(),t=$("<div><div>").appendTo(e.owner);var s=e.margin,l=IG$.j$ext._w(e.owner)-s.right-s.left,c=IG$.j$ext._h(e.owner)-s.top-s.bottom,f=d3.scale.linear().domain([a[0].m,a[0].M]).range([0,l]),m=d3.scale.linear().domain([a[1].m,a[1].M]).range([c,0]),u=d3.scale.sqrt().domain([a[2].m,a[2].M]).range([0,40]),h=d3.scale.category10(),p=d3.svg.axis().orient("bottom").scale(f).ticks(12,d3.format(",d")),b=d3.svg.axis().scale(m).orient("left"),g=this.vis=d3.select(t[0]).append("svg").attr("width",l+s.left+s.right).attr("height",c+s.top+s.bottom).append("g").attr("transform","translate("+s.left+","+s.top+")");g.append("g").attr("class","d3-nation-x d3-nation-axis").attr("transform","translate(0,"+c+")").call(p),g.append("g").attr("class","d3-nation-y d3-nation-axis").call(b),g.append("text").attr("class","d3-nation-x d3-nation-label").attr("text-anchor","end").attr("x",l).attr("y",c-6),g.append("text").attr("class","d3-nation-y d3-nation-label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)");var x,v,w=g.append("text").attr("class","d3-nation-year d3-nation-label").attr("text-anchor","end").attr("y",c-24).attr("x",l),M=d3.bisector(function(t){return t[0]}),y=g.append("g").attr("class","d3-nation-dots").selectAll(".dot").data(I(0)).enter();function N(t){t.attr("cx",function(t){var a=f(r(t));return a=a<0?0:a}).attr("cy",function(t){var a=m(o(t));return a=a<0?0:a}).attr("r",function(t){var a=u(i(t));return a=a<0?0:a})}function C(t){t.attr("x",function(t){var a=(a=f(r(t)))<0?0:a,n=u(i(t));return a-(n=n<0?0:n)}).attr("y",function(t){var a=m(o(t));return a=a<0?0:a})}function _(t,a){return i(a)-i(t)}function G(t){v.data(I(t),d).call(N).sort(_),x.data(I(t),d).call(C).sort(_),w.text(e.seglists[Math.floor(t)])}function I(a){return n.map(function(t){return{name:t.name,region:t.region,bbdata1:j(t.bbdata1,a),bbdata2:j(t.bbdata2,a),bbdata3:j(t.bbdata3,a)}})}function j(t,a){var n=M.left(t,a,0,t.length-1),e=t[n];if(0<n){var r=t[n-1],o=(a-e[0])/(r[0]-e[0]);return e[1]*(1-o)+r[1]*o}return e[1]}(v=y.append("circle").attr("class","d3-nation-dot").style("fill",function(t){return h(t.region)}).call(N).sort(_)).append("title").text(function(t){return t.name}),x=y.append("text").text(function(t){return t.name}).call(C),g.transition().duration(800*e.segmax).ease("linear").tween("year",function(){var a=d3.interpolateNumber(0,e.segmax-1);return function(t){G(a(t))}}).each("end",function(){var t=w.node().getBBox(),a=d3.scale.linear().domain([0,e.segmax]).range([t.x+10,t.x+t.width-10]).clamp(!0);function n(){G(a.invert(d3.mouse(this)[0]))}g.append("rect").attr("class","d3-nation-overlay").attr("x",t.x).attr("y",t.y).attr("width",t.width).attr("height",t.height).on("mouseover",function(){w.classed("active",!0)}).on("mouseout",function(){w.classed("active",!1)}).on("mousemove",n).on("touchmove",n)})},findCols:function(t,a){for(var n=this.sheetoption,e=-1,r=0;r<n.model.rows.length;r++)if(n.model.rows[r].name==t){e=r;break}if(-1==e&&0<n.model.measures.length)for(r=0;r<n.model.measures.length;r++)if(n.model.measures[r].name==t){e=r+a;break}return e}};
window.d3&&(d3.sankey=function(){var t={},u=24,i=8,f=[1,1],a=[],s=[];function r(){function t(n,t){return n.source.y-t.source.y}function r(n,t){return n.target.y-t.target.y}a.forEach(function(n){n.sourceLinks.sort(r),n.targetLinks.sort(t)}),a.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function y(n){return n.y+n.dy/2}function h(n){return n.value}return t.nodeWidth=function(n){return arguments.length?(u=+n,t):u},t.nodePadding=function(n){return arguments.length?(i=+n,t):i},t.nodes=function(n){return arguments.length?(a=n,t):a},t.links=function(n){return arguments.length?(s=n,t):s},t.size=function(n){return arguments.length?(f=n,t):f},t.layout=function(n){return a.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),s.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=a[n.source]),"number"==typeof r&&(r=n.target=a[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)}),a.forEach(function(n){n.value=Math.max(d3.sum(n.sourceLinks,h),d3.sum(n.targetLinks,h))}),function(){var t,n=a,r=0;for(;n.length;)t=[],n.forEach(function(n){n.x=r,n.dx=u,n.sourceLinks.forEach(function(n){t.push(n.target)})}),n=t,++r;(function(t){a.forEach(function(n){n.sourceLinks.length||(n.x=t-1)})})(r),function(t){a.forEach(function(n){n.x*=t})}((width-u)/(r-1))}(),function(n){var t=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(a).map(function(n){return n.values});(function(){var r=d3.min(t,function(n){return(f[1]-(n.length-1)*i)/d3.sum(n,h)});t.forEach(function(n){n.forEach(function(n,t){n.y=t,n.dy=n.value*r})}),s.forEach(function(n){n.dy=n.value*r})})(),e();for(var r=1;0<n;--n)o(r*=.99),e(),u(r),e();function u(r){function u(n){return y(n.source)*n.value}t.forEach(function(n,t){n.forEach(function(n){var t;n.targetLinks.length&&(t=d3.sum(n.targetLinks,u)/d3.sum(n.targetLinks,h),n.y+=(t-y(n))*r)})})}function o(r){function u(n){return y(n.target)*n.value}t.slice().reverse().forEach(function(n){n.forEach(function(n){var t;n.sourceLinks.length&&(t=d3.sum(n.sourceLinks,u)/d3.sum(n.sourceLinks,h),n.y+=(t-y(n))*r)})})}function e(){t.forEach(function(n){var t,r,u,o=0,e=n.length;for(n.sort(c),u=0;u<e;++u)0<(r=o-(t=n[u]).y)&&(t.y+=r),o=t.y+t.dy+i;if(0<(r=o-i-f[1]))for(o=t.y-=r,u=e-2;0<=u;--u)0<(r=(t=n[u]).y+t.dy+i-o)&&(t.y-=r),o=t.y})}function c(n,t){return n.y-t.y}}(n),r(),t},t.relayout=function(){return r(),t},t.link=function(){var f=.5;function t(n){var t=n.source.x+n.source.dx,r=n.target.x,u=d3.interpolateNumber(t,r),o=u(f),e=u(1-f),c=n.source.y+n.sy+n.dy/2,i=n.target.y+n.ty+n.dy/2;return"M"+t+","+c+"C"+o+","+c+" "+e+","+i+" "+r+","+i}return t.curvature=function(n){return arguments.length?(f=+n,t):f},t},t});
IG$.v$Sankey=function(t){this.owner=t,this.bb=null,this.initialize()},IG$.v$Sankey.prototype={initialize:function(){var t,e=this,n=e.owner,a=$("<div></div>").appendTo(n);e.width=IG$.j$ext._w(n),e.height=IG$.j$ext._h(n),e.margin={top:1,right:1,bottom:6,left:1},this.bb||(this.bb=IG$.c$BullChartV(),IG$.j$ext._w(this.bb,e.width-e.margin.right-e.margin.left),IG$.j$ext._h(this.bb,e.height-e.margin.top-e.margin.bottom)),t=$("<ul></ul>").appendTo(a),e.gtp=t,t=$("<li></li>").appendTo(e.gtp),$("<div>Ranges</div>").appendTo(t),e.ranges=$("<combobox></combobox>").appendTo(t),t=$("<li></li>").appendTo(e.gtp),$("<div>Measures</div>").appendTo(t),e.measures=$("<combobox></combobox>").appendTo(t),t=$("<li></li>").appendTo(e.gtp),$("<div>Markers</div>").appendTo(t),e.markers=$("<combobox></combobox>").appendTo(t)},loadData:function(t){for(var e,n,a,r,o,i=this,d=(i.owner,i.width),l=i.height,s=i.margin,p=$("<div><div>").appendTo(i.owner),h=(d3.select(p[0]).append("svg").attr("width",d+s.left+s.right).attr("height",l+s.top+s.bottom).append("g").attr("transform","translate("+s.left+","+s.top+")"),{nodes:[],lines:[]}),u=t._tabledata,c=t.colfix,g=t.rowfix,f=(0<u.length&&u[0].length,0+c),m={},b=0;b<c;b++)mapinfo.push({});for(b=g;b<u.length;b++)for(e=0;e<c;e++)m[n=u[b][e].code]||(r=h.nodes.length,m[n]=r,h.nodes.push(n));for(b=g;b<u.length;b++)for(e=0;e<c;e++)n=u[b][e].code,e+1<c&&(a=u[b][e+1].code,o={source:m[n],target:m[a],value:Number(u[b][f].code)},h.lines.push(o));i.drawChart(h)},drawChart:function(t){function e(t){return n(t)+" TWh"}var n=d3.format(",.0f"),a=d3.scale.category20(),r=d3.sankey().nodeWidth(15).nodePadding(10).size([width,height]),o=r.link();r.nodes(t.nodes).links(t.links).layout(32);var i=svg.append("g").selectAll(".link").data(t.links).enter().append("path").attr("class","link").attr("d",o).style("stroke-width",function(t){return Math.max(1,t.dy)}).sort(function(t,e){return e.dy-t.dy});i.append("title").text(function(t){return t.source.name+" �� "+t.target.name+"\n"+e(t.value)});var d=svg.append("g").selectAll(".node").data(t.nodes).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).call(d3.behavior.drag().origin(function(t){return t}).on("dragstart",function(){this.parentNode.appendChild(this)}).on("drag",function(t){d3.select(this).attr("transform","translate("+t.x+","+(t.y=Math.max(0,Math.min(height-t.dy,d3.event.y)))+")"),r.relayout(),i.attr("d",o)}));d.append("rect").attr("height",function(t){return t.dy}).attr("width",r.nodeWidth()).style("fill",function(t){return t.color=a(t.name.replace(/ .*/,""))}).style("stroke",function(t){return d3.rgb(t.color).darker(2)}).append("title").text(function(t){return t.name+"\n"+e(t.value)}),d.append("text").attr("x",-6).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(t){return t.name}).filter(function(t){return t.x<width/2}).attr("x",6+r.nodeWidth()).attr("text-anchor","start")}};
function randomize(t){return t.randomizer||(t.randomizer=randomizer(t)),t.ranges=t.ranges.map(t.randomizer),t.markers=t.markers.map(t.randomizer),t.measures=t.measures.map(t.randomizer),t}function randomizer(t){var r=.2*d3.max(t.ranges);return function(t){return Math.max(0,t+r*(Math.random()-.5))}}function bulletRanges(t){return t.ranges}function bulletMarkers(t){return t.markers}function bulletMeasures(t){return t.measures}function bulletTranslate(r){return function(t){return"translate("+r(t)+",0)"}}function bulletWidth(r){var a=r(0);return function(t){return Math.abs(r(t)-a)}}IG$.c$BulChart=function(t){this.owner=t,this.bb=null,this.initialize()},IG$.c$BulChart.prototype={initialize:function(){var t,r=this,a=r.owner,e=$("<div></div>").appendTo(a);r.width=IG$.j$ext._w(a),r.height=IG$.j$ext._h(a),r.margin={top:5,right:40,bottom:20,left:120},r.bb||(r.bb=IG$.c$BullChartV(),IG$.j$ext._w(r.bb,r.width-r.margin.right-r.margin.left),IG$.j$ext._h(r.bb,r.height-r.margin.top-r.margin.bottom)),t=$("<ul></ul>").appendTo(e),r.gtp=t,t=$("<li></li>").appendTo(r.gtp),$("<div>Ranges</div>").appendTo(t),r.ranges=$("<combobox></combobox>").appendTo(t),t=$("<li></li>").appendTo(r.gtp),$("<div>Measures</div>").appendTo(t),r.measures=$("<combobox></combobox>").appendTo(t),t=$("<li></li>").appendTo(r.gtp),$("<div>Markers</div>").appendTo(t),r.markers=$("<combobox></combobox>").appendTo(t)},loadData:function(t){var r=this,a=(r.owner,r.width),e=r.height,n=r.margin,i=$("<div><div>").appendTo(r.owner),l=d3.select(i[0]).selectAll("svg"),o=r.bb,s=r.getData();l.data(s).enter().append("svg").attr("class","bullet").attr("width",a).attr("height",e).append("g").attr("transform","translate("+n.left+","+n.top+")").call(o);var u=l.append("g").attr("text-anchor","end").attr("transform","translate(-6,"+(e-n.top-n.bottom)/2+")");u.append("text").attr("class","title").text(function(t){return t.title}),u.append("text").attr("class","subtitle").attr("dy","1em").text(function(t){return t.subtitle}),r.vis=l,r.title=u,o.duration(1e3)},drawChart:function(){var t=this.bb;vis.datum(randomize).call(t)},getData:function(){for(var t,r,a,e,n,i,l,o=[],s=mresult._tabledata,u=mresult.colfix,d=mresult.rowfix,c=0<s.length?s[0].length:0,h={},m={},g=u;g<c;g++);for(g=d;g<s.length;g++){for(r={title:null,ranges:[],measures:[],markers:[]},l=i=null,t=0;t<c;t++)t<u?(a=s[g][t].text||s[g][t].code,r.title=0==g?a:r.title+" "+a):(a=Number(s[g][t].code),e=t==u?a:Math.max(e,a),n=t==u?a:Math.min(n,a),1==h[t]&&(l=null==i?i=a:(i=Math.min(i,a),Math.max(l,a))),1==m[t]&&r.markers.push(a));r.ranges=[n,void 0,e],r.measures=[i,l],o.push(r)}return o}},IG$.c$BullChartV=function(){var r="left",f=!1,x=0,v=bulletRanges,$=bulletMarkers,y=bulletMeasures,w=380,k=30,T=null;function a(t){t.each(function(t,r){var a=v.call(this,t,r).slice().sort(d3.descending),e=$.call(this,t,r).slice().sort(d3.descending),n=y.call(this,t,r).slice().sort(d3.descending),i=d3.select(this),l=d3.scale.linear().domain([0,Math.max(a[0],e[0],n[0])]).range(f?[w,0]:[0,w]),o=this.__chart__||d3.scale.linear().domain([0,1/0]).range(l.range());this.__chart__=l;var s=bulletWidth(o),u=bulletWidth(l),d=i.selectAll("rect.range").data(a);d.enter().append("svg:rect").attr("class",function(t,r){return"range s"+r}).attr("width",s).attr("height",k).attr("x",f?o:0).transition().duration(x).attr("width",u).attr("x",f?l:0),d.transition().duration(x).attr("x",f?l:0).attr("width",u).attr("height",k);var c=i.selectAll("rect.measure").data(n);c.enter().append("svg:rect").attr("class",function(t,r){return"measure s"+r}).attr("width",s).attr("height",k/3).attr("x",f?o:0).attr("y",k/3).transition().duration(x).attr("width",u).attr("x",f?l:0),c.transition().duration(x).attr("width",u).attr("height",k/3).attr("x",f?l:0).attr("y",k/3);var h=i.selectAll("line.marker").data(e);h.enter().append("svg:line").attr("class","marker").attr("x1",o).attr("x2",o).attr("y1",k/6).attr("y2",5*k/6).transition().duration(x).attr("x1",l).attr("x2",l),h.transition().duration(x).attr("x1",l).attr("x2",l).attr("y1",k/6).attr("y2",5*k/6);var m=T||l.tickFormat(8),g=i.selectAll("g.tick").data(l.ticks(8),function(t){return this.textContent||m(t)}),p=g.enter().append("svg:g").attr("class","tick").attr("transform",bulletTranslate(o)).style("opacity",1e-6);p.append("svg:line").attr("y1",k).attr("y2",7*k/6),p.append("svg:text").attr("text-anchor","middle").attr("dy","1em").attr("y",7*k/6).text(m),p.transition().duration(x).attr("transform",bulletTranslate(l)).style("opacity",1);var b=g.transition().duration(x).attr("transform",bulletTranslate(l)).style("opacity",1);b.select("line").attr("y1",k).attr("y2",7*k/6),b.select("text").attr("y",7*k/6),g.exit().transition().duration(x).attr("transform",bulletTranslate(l)).style("opacity",1e-6).remove()}),d3.timer.flush()}return a.orient=function(t){return arguments.length?(f="right"==(r=t)||"bottom"==r,a):r},a.ranges=function(t){return arguments.length?(v=t,a):v},a.markers=function(t){return arguments.length?($=t,a):$},a.measures=function(t){return arguments.length?(y=t,a):y},a.width=function(t){return arguments.length?(w=t,a):w},a.height=function(t){return arguments.length?(k=t,a):k},a.tickFormat=function(t){return arguments.length?(T=t,a):T},a.duration=function(t){return arguments.length?(x=t,a):x},a};