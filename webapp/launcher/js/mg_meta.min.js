IG$.mg_meta=$s.extend(IG$.v$pnl,{layout:"fit",_module:"com.amplix.migration.upgrade_v3.MetaMigration",autoScroll:!0,initapp:function(){var e=this,t=e.down("[name=d_file]").el.dom,i=$(".m_fileupload",t),o=e.down("[name=d_upfiles]");i.empty(),fileupload=$("<input type='file' name='files[]' data-url='upload' multiple></input>").appendTo(i),dropzone=$("<div class='filedropzone fade well'>Drop files here</div>").appendTo(i),d_progress=$("<div class='file-progress'><div class='bar' style='width: 0%;'></div></div>").appendTo(i),fileupload.fileupload({url:ig$.servlet,dataType:"json",done:function(t,i){var l,d,n,a,s=i.result||{errorcode:"0xffff",errormsg:"Server incorrect responding"},r=[];if(s.errorcode)IG$.ShowErrorMessage(s,e,null);else if(s.result)for(l=s.result.length?s.result:[s.result],d=0;d<l.length;d++)n=l[d],r.push(n);if(r&&r.length)for(o.show(),d=0;d<r.length;d++)a=o.store.add(r[d]),o.selModel.select(a,!0)},progressall:function(e,t){var i=parseInt(t.loaded/t.total*100,10),o=$(".bar",d_progress);o.css("width",i+"%"),o.text("Loaded "+t.loaded+" / "+t.total)},dropZone:dropzone}).bind("fileuploadsubmit",(function(e,t){})),fileupload.fileupload("option","url",ig$.servlet)},toolbarHandler:function(e){var t,i=this,o=i.down("[name=d_upfiles]"),l=i.down("[name=d_doc]"),d=[];switch(e){case"cmd_c_files":for(t=0;t<o.store.data.items.length;t++)d.push(o.store.data.items[t]);if(i.file_lists=d,!i.checkRequired())return;d.length&&(i.setLoading(!0),i.$imp_cnts=[],i.migrate_import());break;case"cmd_c_doc":var n=l.getSelectionModel().selected;if(i.doc_lists=d,!i.checkRequired())return;n&&n.length&&(i.setLoading(!0),i.execute_upgrade())}},checkRequired:function(){return!0},migrate_import:function(){var e=this;e.down("[name=d_upfiles]");if(e.file_lists&&e.file_lists.length){var t=e.file_lists.splice(0,1)[0],i=new IG$._rpc$;i.stoploading=!1,i.init(e,{ack:"migration",payload:{module:e._module},mbody:{option:"migrate_import",items:[t.data]},meta_type:"object"},e,(function(e){this.$imp_cnts=this.$imp_cnts.concat(e),this.migrate_import()})),i.send()}else{e.setLoading(!1),e.down("[name=d_doc]").store.loadData(e.$imp_cnts)}},execute_upgrade:function(){var e,t=this,i=t.down("[name=d_doc]"),o=t.down("[name=d_upfiles]"),l=i.getSelectionModel().selected,d=[],n=[];for(e=0;e<l.length;e++)a=l.items[e],n.push(a.get("uid"));for(e=0;e<o.store.data.items.length;e++)a=o.store.data.items[e],d.push(a.data);var a=t.file_lists.splice(0,1)[0],s=new IG$._rpc$;s.stoploading=!1,s.init(t,{ack:"migration",payload:{module:t._module},mbody:{option:"execute_migrate",files:d,selections:n},meta_type:"object"},t,(function(e){})),s.send()},initComponent:function(){$s.apply(this,{items:[{xtype:"container",padding:5,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Meta file upload",items:[{html:"<div class='m_fileupload'></div>",name:"d_file",height:120,bodyPadding:10},{name:"d_upfiles",xtype:"gridpanel",height:320,hidden:!0,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["uid","filename","fileext"]},columns:[{text:IRm$.r1("L_FILENAME"),dataIndex:"filename",flex:1},{text:IRm$.r1("L_FILEEXT"),dataIndex:"fileext",flex:1},{xtype:"actioncolumn",width:20,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,i){var o=e.store.getAt(t);e.store.remove(o)}}]}],bbar:["->",{xtype:"button",text:"Load Meta Informations",handler:function(){this.toolbarHandler("cmd_c_files")},scope:this},{xtype:"button",text:"Cancel All Files",handler:function(){var e=this.down("[name=d_upfiles]");e.store.removeAll(),e.hide(),this.down("[name=d_file]").hide()},scope:this}]}]},{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Backup Items",items:[{name:"d_doc",xtype:"gridpanel",height:500,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["name","id","description"]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",minWidth:180,flex:1},{text:"Node Path",dataIndex:"nodepath_name",minWidth:300,flex:1},{text:IRm$.r1("B_DESC"),dataIndex:"description",minWidth:100,flex:1}],bbar:["->",{xtype:"button",text:"Migrate Selected Items",handler:function(){this.toolbarHandler("cmd_c_doc")},scope:this}]}]}]}]}),IG$.mg_meta.superclass.initComponent.call(this)},listeners:{afterrender:function(e){e.initapp()}}});