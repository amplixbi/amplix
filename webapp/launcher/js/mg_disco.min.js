IG$.mg_disco=$s.extend(IG$.v$pnl,{layout:"fit",_module:"com.amplix.migration.discoverer.DiscoMigration",autoScroll:!0,initapp:function(){var s=this,e=s.down("[name=d_file]").el.dom,t=$(".m_fileupload",e),r=s.down("[name=d_upfiles]");t.empty(),fileupload=$("<input type='file' name='files[]' data-url='upload' multiple></input>").appendTo(t),dropzone=$("<div class='filedropzone fade well'>Drop files here</div>").appendTo(t),d_progress=$("<div class='file-progress'><div class='bar' style='width: 0%;'></div></div>").appendTo(t),fileupload.fileupload({url:ig$.servlet,dataType:"json",done:function(e,t){var a,i,l,o,d=t.result||{errorcode:"0xffff",errormsg:"Server incorrect responding"},n=[];if(d.errorcode)IG$.ShowErrorMessage(d,s,null);else if(d.result)for(a=d.result.length?d.result:[d.result],i=0;i<a.length;i++)l=a[i],n.push(l);if(n&&n.length)for(r.show(),i=0;i<n.length;i++)o=r.store.add(n[i]),r.selModel.select(o,!0)},progressall:function(e,t){var a=parseInt(t.loaded/t.total*100,10),i=$(".bar",d_progress);i.css("width",a+"%"),i.text("Loaded "+t.loaded+" / "+t.total)},dropZone:dropzone}).bind("fileuploadsubmit",function(e,t){}),fileupload.fileupload("option","url",ig$.servlet),s.load_dbpool()},updateSchemas:function(e){var t,a=this,i=a.down("[name=eul_schema]");e?((t=new IG$._rpc$).init(a,{ack:"tablecontent",payload:{uid:e},mbody:{option:"standard"}},a,function(e){var t=e.schemas;i.store.loadData(t)}),t.send()):i.store.loadData([])},toolbarHandler:function(e){var t,a,i=this,l=i.down("[name=d_upfiles]"),o=i.down("[name=d_bas]"),d=i.down("[name=d_doc]"),n=i.down("[name=eul_metadb]"),s=i.down("[name=eul_schema]"),r=[];switch(e){case"cmd_c_files":for(a=0;a<l.store.data.items.length;a++)l.store.data.items[a].data.selected&&r.push(l.store.data.items[a]);if(i.file_lists=r,!i.checkRequired())return;r.length&&(i.setLoading(!0),i.migrate_eex());break;case"cmd_r_doc":if(t=new IG$._rpc$,!i.checkRequired())return;t.init(i,{ack:"migration",payload:{module:i._module},mbody:{option:"list_doc",eul_meta:n.getValue(),eul_schema:s.getValue(),bobj:i._bobj.uid},meta_type:"object"},i,function(e){d.store.loadData(e)}),t.send();break;case"cmd_c_doc":for(a=0;a<d.store.data.items.length;a++)d.store.data.items[a].data.selected&&r.push(d.store.data.items[a]);if(i.doc_lists=r,!i.checkRequired())return;r.length&&(i.setLoading(!0),i.migrate_doc());break;case"cmd_r_bas":if(t=new IG$._rpc$,!i.checkRequired())return;t.init(i,{ack:"migration",payload:{module:i._module},mbody:{option:"list_bas",eul_meta:n.getValue(),eul_schema:s.getValue(),bobj:i._bobj.uid},meta_type:"object"},i,function(e){o.store.loadData(e)}),t.send();break;case"cmd_c_bas":for(a=0;a<o.store.data.items.length;a++)o.store.data.items[a].data.selected&&r.push(o.store.data.items[a]);if(i.bas_lists=r,!i.checkRequired())return;r.length&&(i.setLoading(!0),i.migrate_bas())}},checkRequired:function(){var e=this,t=!0,a=e.down("[name=eul_metadb]"),i=e.down("[name=eul_schema]"),l=e.down("[name=tbobject]");return a.clearInvalid(),i.clearInvalid(),l.clearInvalid(),a.getValue()||(a.markInvalid("Required field"),t=!1),i.getValue()||(i.markInvalid("Required field"),t=!1),e._bobj||(l.markInvalid("Required field"),t=!1),t},load_dbpool:function(){var e=new IG$._rpc$;e.init(this,{ack:"tablecontent",payload:{address:"/"},mbody:{option:"standard"}},this,function(e){var t,a,i=[],l=this.down("[name=eul_metadb]");if(i.push({name:"-- Select Database --",uid:""}),e&&e.length)for(a=0;a<e.length;a++)(t=e[a]).name=t.disp||t.name,i.push(t);l.store.loadData(i),l.setValue("")},!1),e.send()},migrate_eex:function(){var t,e,a=this,i=a.down("[name=d_upfiles]");a.file_lists&&a.file_lists.length?(t=a.file_lists.splice(0,1)[0],(e=new IG$._rpc$).stoploading=!1,e.init(a,{ack:"migration",payload:{module:a._module},mbody:{option:"migrate_eex",eul_meta:a.down("[name=eul_metadb]").getValue(),eul_schema:a.down("[name=eul_schema]").getValue(),bobj:a._bobj.uid,items:[t.data]},meta_type:"object"},a,function(e){i.store.remove(t),a.migrate_eex()}),e.send()):a.setLoading(!1)},migrate_doc:function(){var t,e,a=this,i=a.down("[name=d_doc]");a.doc_lists&&a.doc_lists.length?(t=a.doc_lists.splice(0,1)[0],(e=new IG$._rpc$).stoploading=!1,e.init(a,{ack:"migration",payload:{module:a._module},mbody:{option:"migrate_doc",eul_meta:a.down("[name=eul_metadb]").getValue(),eul_schema:a.down("[name=eul_schema]").getValue(),bobj:a._bobj.uid,items:[t.data]},meta_type:"object"},a,function(e){i.selModel.select(t,!1),a.migrate_doc()}),e.send()):a.setLoading(!1)},migrate_bas:function(){var t,e,a=this,i=a.down("[name=d_bas]");a.bas_lists&&a.bas_lists.length?(t=a.bas_lists.splice(0,1)[0],(e=new IG$._rpc$).stoploading=!1,e.init(a,{ack:"migration",payload:{module:a._module},mbody:{option:"migrate_bas",eul_meta:a.down("[name=eul_metadb]").getValue(),eul_schema:a.down("[name=eul_schema]").getValue(),bobj:a._bobj.uid,items:[t.data]},meta_type:"object"},a,function(e){i.selModel.select(t,!1),a.migrate_bas()}),e.send()):a.setLoading(!1)},initComponent:function(){var t=this;$s.apply(t,{items:[{xtype:"container",padding:5,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Options",items:[{xtype:"combobox",fieldLabel:"EUL metadatabase",name:"eul_metadb",displayField:"name",labelField:"name",valueField:"uid",store:{fields:["uid","name","disp"]},listeners:{change:function(e){this.updateSchemas(e.getValue())},scope:this}},{xtype:"combobox",fieldLabel:"EUL Schema",name:"eul_schema",displayField:"name",labelField:"name",valueField:"name",store:{fields:["uid","name","disp"]}}]},{xtype:"container",width:20},{xtype:"fieldset",flex:1,title:"Target Meta",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:"Target Business Object",items:[{xtype:"textfield",flex:1,name:"tbobject",readOnly:!0},{xtype:"button",text:"..",handler:function(){var e=new IG$.metaSelectDlg({visibleItems:"folder;bobject",tree_options:{cubebrowse:!0,rootuid:null},callback:new IG$.callBackObj(t,function(e){t.down("[name=tbobject]").setValue(e.name),t._bobj=e})});IG$.checkLogin(this,e)},scope:this}]}]}]},{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"EEX file upload",items:[{html:"<div class='m_fileupload'></div>",name:"d_file",height:120,bodyPadding:10},{name:"d_upfiles",xtype:"gridpanel",height:320,hidden:!0,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["uid","filename","fileext"]},columns:[{text:IRm$.r1("L_FILENAME"),dataIndex:"filename",flex:1},{text:IRm$.r1("L_FILEEXT"),dataIndex:"fileext",flex:1},{xtype:"actioncolumn",width:20,items:[{iconCls:"icon-grid-delete",tooltip:"Delete item",handler:function(e,t,a){var i=e.store.getAt(t);e.store.remove(i)}}]}],bbar:["->",{xtype:"button",text:"Commit All Files",handler:function(){this.toolbarHandler("cmd_c_files")},scope:this},{xtype:"button",text:"Cancel All Files",handler:function(){var e=this.down("[name=d_upfiles]");e.store.removeAll(),e.hide(),this.down("[name=d_file]").hide()},scope:this}]}]},{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Documents",items:[{name:"d_doc",xtype:"gridpanel",height:300,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["name","id","description"]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1},{text:IRm$.r1("B_DESC"),dataIndex:"description",flex:1}],bbar:[{xtype:"button",text:"Refresh",handler:function(){this.toolbarHandler("cmd_r_doc")},scope:this},"->",{xtype:"button",text:"Commit All Files",handler:function(){this.toolbarHandler("cmd_c_doc")},scope:this}]}]},{xtype:"fieldset",flex:1,layout:{type:"vbox",align:"stretch"},title:"Business Area",items:[{name:"d_bas",xtype:"gridpanel",height:300,selType:"checkboxmodel",selModel:{mode:"MULTI"},store:{fields:["name","id","description"]},columns:[{text:IRm$.r1("B_NAME"),dataIndex:"name",flex:1},{text:IRm$.r1("B_DESC"),dataIndex:"description",flex:1}],bbar:[{xtype:"button",text:"Refresh",handler:function(){this.toolbarHandler("cmd_r_bas")},scope:this},"->",{xtype:"button",text:"Commit All Files",handler:function(){this.toolbarHandler("cmd_c_bas")},scope:this},{xtype:"button",text:"Cancel All Files",handler:function(){var e=this.down("[name=d_upfiles]");e.store.removeAll(),e.hide(),this.down("[name=d_file]").hide()},scope:this}]}]}]}]}),IG$.mg_disco.superclass.initComponent.call(this)},listeners:{afterrender:function(e){e.initapp()}}});